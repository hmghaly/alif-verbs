<!DOCTYPE html>
<html lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-61484468-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-61484468-1');
    </script>

  <title>ALIF Verbs</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" 
      type="image/png" 
      href="img/icons/lego.png" />

<meta name="description" content="Alif Verbs - learn Arabic Verb Conjugation. Learn the different tenses and forms for verbs. Learn verbs in Modern Standard Arbic, Egyptian Arabic, and other Arabic varieties. Learn steadily, 5 minutes a day, five new verbs every day!">
      <meta name="keywords" content="Arabic verbs forms conjugation alphabet letters reading writing listening games online web mobile androin ios fun app pronunciation diacritics tashkeel harakaat pronunciation">

      <meta name="google-signin-client_id" content="761509954064-gb2hb7onq6igr2nrqvc6v7dnegd99vo5.apps.googleusercontent.com">
      <meta name="google-signin-scope" content="profile email">
      <script src="https://apis.google.com/js/platform.js" async defer></script>



  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
  <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

  <link rel="manifest" href="manifest.json" crossorigin="use-credentials">


  <script src="js/script.js"></script>

<!--   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1461464026864680"
     crossorigin="anonymous"></script> -->

</head>

<style type="text/css">
	
#intro_div { height: 50%; }
.buttonload {
  background-color: #04AA6D; /* Green background */
  border: none; /* Remove borders */
  color: white; /* White text */
  padding: 12px 24px; /* Some padding */
  font-size: 16px; /* Set a font-size */
}

/* Add a right margin to each icon */
.fa {
  margin-left: -12px;
  margin-right: 8px;
}
/*.nav {
    position:absolute;
    bottom:0;
    right:10%;
}
.sub_div {
    position: absolute;
    bottom: 0px;
}*/

.flex {
    display: flex;
}

.g-signin2{
  width: 100%;
}
.g-signin2 > div{
  margin: 0 auto;
}

.fb-login-button{
	width: 100%;
}
.fb-login-button > div{
  margin: 0 auto;
}
</style>

<script type="text/javascript">
var arabic_var=null //"msa" //ega lva sya lba maa saa gla iqa kwa lya sda dza tna 
//arabic_var="eg_ar"
//arabic_var="msa"
var cur_screen=null

var user={}
var quiz={}
var answer={}
var session={}
var timer={}
var results={}
// verb_id_list verb_dict
var loading={} //check if loading is complete, together with animation
var game_data={} //parsed json file generated externally - a list of verb objects
var verb_id_list=[] //list of verb ids based on game data
var verb_dict={} //a dictionary of game data, where the key is the verb ID
var audio_scope;
var initial_n_hints=20
var initial_quiz_time=300
var overall_accuracy={} //temporary copy of the accuraacy before the start of the quiz
	

//var audio_prefix="../../audio/eg-verbs-mini/"
var audio_prefix="https://champolu.net/rec/projects/eg-verbs-100/user/"
var lang_icon="img/arabic.svg"


var lang_info={}
lang_info["eg_ar"]={}
lang_info["eg_ar"]["audio_prefix"]="https://champolu.net/rec/projects/eg-verbs-100/user/"
lang_info["eg_ar"]["icon"]="img/egypt.svg"

lang_info["msa"]={}
lang_info["msa"]["audio_prefix"]="https://champolu.com/audio/msa_verbs50/"
lang_info["msa"]["icon"]="img/arabic.svg"


var app_name="alif-verbs"
// nav_dict["arabic_var"]=null
// nav_dict["screen"]=null
// nav_dict["last_active"]=Date.now();
time_now=Date.now()
//set_local_strorage(app_name,"nav_dict",nav_dict)
var nav_dict=get_local_strorage(app_name,"nav_dict")
if (nav_dict==null || nav_dict==undefined) var nav_dict={}

var score=get_local_strorage(app_name,"score")
if (score==null || score==undefined) var score={}	
//if (score.coins==null || score.coins==undefined) score.coins=0


var game_utils=get_local_strorage(app_name,"game_utils") //game utilities: coins, hints , etc
if (game_utils==null || game_utils==undefined) var game_utils={}
if (game_utils.coins==null || game_utils.coins==undefined) game_utils.coins=0
if (game_utils.hints==null || game_utils.hints==undefined) game_utils.hints=initial_n_hints 	

var accuracy=get_local_strorage(app_name,"accuracy")
if (accuracy==null || accuracy==undefined) accuracy={}

function reset_accuracy(){set_local_strorage(app_name,"accuracy",{})}
// if (accuracy.overall==null) accuracy.overall={}
// if (accuracy.current==null) accuracy.current={}

transition_emojis=["img/face-with-open-mouth_1f62e.png","img/thinking-face_1f914.png"]
positive_emojis=["img/relieved-face_1f60c.png","img/smiling-face_263a-fe0f.png","img/smiling-face-with-smiling-eyes_1f60a.png","img/smiling-face-with-sunglasses_1f60e.png","img/star-struck_1f929.png","img/winking-face_1f609.png","img/winking-face-with-tongue_1f61c.png"]
negative_emojis=["img/face-screaming-in-fear_1f631.png","img/face-with-hand-over-mouth_1f92d.png","img/face-with-head-bandage_1f915.png","img/slightly-frowning-face_1f641.png","img/unamused-face_1f612.png"]
	
var settings=get_local_strorage(app_name,"settings")
if (settings==null || settings==undefined) settings={}

var progress_history=get_local_strorage(app_name,"progress_history")
if (progress_history==null || progress_history==undefined) progress_history=[]
//if (settings.quiz_time==null || settings.quiz_time==undefined) settings.quiz_time=initial_quiz_time

var cur_address=window.location.pathname //"/dev/alif-verbs/"



function ui_alert(msg_txt){

}

function deploy_analysis_table(analysis_item_name0,analysis_obj0,analysis_table_id0,is_hyperlinked=false){
	headers=[analysis_item_name0,'correct <img src="img/check.png" height="20px" />','incorrect <img src="img/wrong.png" height="20px" />',"total",'Accuracy <img src="img/target.png" height="20px" />']
	table_array=[]
	table_array.push(headers)
	tmp_array=[]

	//analysis_obj0=accuracy[arabic_var]["overall"]["verb_id"]
	for (key0 of Object.keys(analysis_obj0)){
		if (is_hyperlinked) first_row_item=create_hyperlink(key0,"show_conj_modal")
		else first_row_item=create_hyperlink(key0,"show_conj_modal")
		cur_row_items=[first_row_item]
		tmp_dict={}
		for (cit of ["correct","incorrect","total"]){
			cur_val=get_dict(analysis_obj0,[key0,cit],0)
			if (cur_val==null || cur_val==undefined) cur_val=0
			tmp_dict[cit]=cur_val
			console.log(cur_val)
			cur_row_items.push(cur_val)
		}
		cur_accuracy=tmp_dict["correct"]/tmp_dict["total"]
		cur_row_items.push(cur_accuracy)
		tmp_array.push(cur_row_items)
	}
	tmp_array=sort_array(tmp_array,-1)
	for (t_item of tmp_array){
		t_item[len(t_item)-1]=get_percent(t_item[len(t_item)-1])
		table_array.push(make_str_array(t_item))
	}
	console.log(tmp_array)
	fill_table(analysis_table_id0,table_array)

}

function game_ended(){
	console.log("game_ended")
	show_screen("after_game_div")
	//after_game_score after_game_accuracy after_game_correct_total analysis_table
	$$("after_game_score").innerHTML=""+results.score
	$$("after_game_accuracy").innerHTML=""+Math.round(results.accuracy*100)+"%"
	correct_total_str=""+results.n_answered+ " / "+results.n_attempted
	$$("after_game_correct_total").innerHTML=correct_total_str

	tmp_progress_obj={}
	tmp_progress_obj["results"]=results
	tmp_progress_obj["accuracy_stat"]=accuracy[arabic_var].current
	tmp_progress_obj["correct"]=results.n_answered
	tmp_progress_obj["total"]=results.n_attempted
	tmp_progress_obj["accuracy"]=results.accuracy
	tmp_progress_obj["score"]=results.score
	tmp_progress_obj["duration"]=settings.quiz_time_minutes
	tmp_progress_obj["date"]=today()
	progress_history.push(tmp_progress_obj)
	set_local_strorage(app_name,"progress_history",progress_history)





	//keys=["correct","incorrect","total"]
	headers=["Verb",'correct <img src="img/check.png" height="20px" />','incorrect <img src="img/wrong.png" height="20px" />',"total",'Accuracy <img src="img/target.png" height="20px" />']

	table_array=[]
	table_array.push(headers)
	tmp_array=[]
	for (verb_id of Object.keys(accuracy[arabic_var].current.verb_id)){
		// conj_link='<a href="javascript:void(0)" name="_name_" onclick="show_conj_modal(this)"><b>'+verb_id+"</b></a>"
		// conj_link=conj_link.replace("_name_",verb_id)
		conj_link=create_hyperlink(verb_id,"show_conj_modal")

		cur_row_items=[conj_link]
		tmp_dict={}
		for (k0 of ["correct","incorrect","total"]){
			cur_val=get_dict(accuracy,[arabic_var,"current","verb_id",verb_id,k0],0)
			if (cur_val==null || cur_val==undefined) cur_val=0
			tmp_dict[k0]=cur_val
			console.log(cur_val)
			// cur_val=accuracy[arabic_var].current.verb[verb_item][k0]
			// if (cur_val==null) cur_val=0
			cur_row_items.push(cur_val)
			//cur_row_items.push(""+cur_val)
		}
		cur_accuracy=tmp_dict["correct"]/tmp_dict["total"]
		cur_row_items.push(cur_accuracy)
		// cur_accuracy_percent=Math.round(100*tmp_dict["correct"]/tmp_dict["total"])
		// cur_row_items.push(""+cur_accuracy_percent+"%")
		tmp_array.push(cur_row_items)

	}
	tmp_array=sort_array(tmp_array,-1)
	for (t_item of tmp_array){
		t_item[len(t_item)-1]=get_percent(t_item[len(t_item)-1])
		table_array.push(make_str_array(t_item))
	}
	console.log(tmp_array)
	fill_table("analysis_table",table_array)
	//accuracy.current.verb

}


function prepare_conjugation(verb_id){
	tutorial_content=$$("tutorial_content")
	tutorial_content.innerHTML=""
		v_obj=verb_dict[verb_id]
		conj_list=[]
		console.log("verb_id",verb_id)
		console.log(v_obj)
		en_forms=v_obj["english"]
		en_base=en_forms.base
		cur_verb_div=create_el_basic("div",tutorial_content)
		cur_verb_div.className="m-1"
		en_header=create_el_basic("h6",cur_verb_div)
		en_header.innerHTML=en_base+"<hr>"
		en_header.style.backgroundColor="lightpink"
		en_header.className="pt-3"
		
		//var forms_table=create_el_basic("table",tutorial_content)
		table_array=[]


		ar_forms=v_obj["forms"]
		//ar_tenses=Object.keys(ar_forms)
		//ar_pronouns=Object.keys(ar_forms.present)
		for (ar_tense of Object.keys(ar_forms)){
			cur_form_obj=ar_forms[ar_tense]
			cur_tense_div=create_el_basic("div",cur_verb_div)
			tense_header=create_el_basic("h7",cur_tense_div)
			tense_header.innerHTML="Tense: "+ ar_tense
			tense_header.style.backgroundColor="lightgreen"
			cur_conj_div=create_el_basic("div",cur_tense_div)
			cur_conj_div.className="row"

			colors=["Azure","Beige","AliceBlue","HoneyDew","Ivory","LavenderBlush","MistyRose","SeaShell"]
			colors_i=0
			for (pronoun0 of Object.keys(cur_form_obj)){
				//corr_en=en_forms[ar_tense]
				en_vp=en_forms["base"] //should be base
				if (ar_tense=="past") en_vp=en_forms[ar_tense]
				if (ar_tense=="imperative") en_vp=en_forms["base"]	
				if (ar_tense=="base") en_vp=en_forms["base"]		
				if (ar_tense=="future") en_vp= "will "+ en_forms["base"]
				if (ar_tense=="present" && (pronoun0=="he" || pronoun0=="she")) en_vp=en_forms["-s"]
				if (ar_tense=="active") en_vp= en_forms["-ing"]
				en_full=pronoun0+" "+en_vp
				ar_form0=cur_form_obj[pronoun0]
				console.log(en_full,ar_form0)
				cur_temp_div=create_el_basic("div",cur_conj_div)
				cur_temp_div.innerHTML="<b>"+en_full+"</b><br>"+ar_form0[0]+"<br>"+ar_form0[1]+"<br>"
				cur_temp_div.className="col-sm-4"
				cur_temp_div.style.backgroundColor=colors[colors_i]
				colors_i+=1
				play_img=img("img/play.png")
				play_img.width=20
				play_img.name=audio_prefix+ar_form0[0]+".mp3"
				play_img.onclick=function(evt){


					//console.log(evt.currentTarget)
					audioObj = new Audio(evt.currentTarget.name);
					audioObj.play();
					// audioObj.addEventListener("canplaythrough", event => {
					//    the audio is now playable; play it if permissions allow 
					//   audioObj.play();
					// })

				}

				cur_temp_div.appendChild(play_img)

			}
		}

}

function prepare_tutorial(){
	tutorial_content=$$("tutorial_content")
	for (const v_obj of game_data.slice(0,10)){
		conj_list=[]
		console.log(v_obj)
		en_forms=v_obj["english"]
		en_base=en_forms.base
		cur_verb_div=create_el_basic("div",tutorial_content)
		cur_verb_div.className="m-1"
		en_header=create_el_basic("h6",cur_verb_div)
		en_header.innerHTML=en_base+"<hr>"
		en_header.style.backgroundColor="lightpink"
		en_header.className="pt-3"
		
		//var forms_table=create_el_basic("table",tutorial_content)
		table_array=[]


		ar_forms=v_obj["forms"]
		//ar_tenses=Object.keys(ar_forms)
		//ar_pronouns=Object.keys(ar_forms.present)
		for (ar_tense of Object.keys(ar_forms)){
			cur_form_obj=ar_forms[ar_tense]
			cur_tense_div=create_el_basic("div",cur_verb_div)
			tense_header=create_el_basic("h7",cur_tense_div)
			tense_header.innerHTML="Tense: "+ ar_tense
			tense_header.style.backgroundColor="lightgreen"
			cur_conj_div=create_el_basic("div",cur_tense_div)
			cur_conj_div.className="row"

			colors=["Azure","Beige","AliceBlue","HoneyDew","Ivory","LavenderBlush","MistyRose","SeaShell"]
			colors_i=0
			for (pronoun0 of Object.keys(cur_form_obj)){
				//corr_en=en_forms[ar_tense]
				en_vp=en_forms["base"] //should be base
				if (ar_tense=="past") en_vp=en_forms[ar_tense]
				if (ar_tense=="imperative") en_vp=en_forms["base"]	
				if (ar_tense=="base") en_vp=en_forms["base"]		
				if (ar_tense=="future") en_vp= "will "+ en_forms["base"]
				if (ar_tense=="present" && (pronoun0=="he" || pronoun0=="she")) en_vp=en_forms["-s"]
				if (ar_tense=="active") en_vp= en_forms["-ing"]
				en_full=pronoun0+" "+en_vp
				ar_form0=cur_form_obj[pronoun0]
				console.log(en_full,ar_form0)
				cur_temp_div=create_el_basic("div",cur_conj_div)
				cur_temp_div.innerHTML="<b>"+en_full+"</b><br>"+ar_form0[0]+"<br>"+ar_form0[1]+"<br>"
				cur_temp_div.className="col-sm-4"
				cur_temp_div.style.backgroundColor=colors[colors_i]
				colors_i+=1
				play_img=img("img/play.png")
				play_img.width=20
				play_img.name=audio_prefix+ar_form0[0]+".mp3"
				play_img.onclick=function(evt){


					//console.log(evt.currentTarget)
					audioObj = new Audio(evt.currentTarget.name);
					audioObj.play();
					// audioObj.addEventListener("canplaythrough", event => {
					//    the audio is now playable; play it if permissions allow 
					//   audioObj.play();
					// })

				}

				cur_temp_div.appendChild(play_img)

			}
		}

	}
}

// function combine_ar_rom(rom0,ar0){
// 	if (settings.quiz_script=="ar_rom") return rom0+" "+ar0
// 	else if (settings.quiz_script=="ar_only") return ar0	
// 	else if (settings.quiz_script=="rom_only") return rom0
// 	else return rom0+" "+ar0		
// }

function prepare_questions(cur_verb_ids){
	tmp_question_list=[] //the final list of questions generated
	q_list=[] //list of raw question objects: English equivalent, Arabic form, and other meta info
	verb_conjugations_obj={} //combining all conjugation questions with the same verb ID
	tense_pronoun_obj={} //object to combine questions with the same tense and pronouns from different verbs
	//data_obj=shuffle(game_data)
	//console.log(game_data)
	for (const v_id of cur_verb_ids){
		v_obj=verb_dict[v_id]
		conj_list=[]
		console.log("verb_id",v_id)
		console.log(v_obj)
		en_forms=v_obj["english"]
		ar_forms=v_obj["forms"]
		num0=v_obj["number"]
		id0=v_obj["id"]
		console.log(en_forms)
		for (ar_tense of Object.keys(ar_forms)){
			cur_form_obj=ar_forms[ar_tense]
			//console.log(ar_tense,cur_form_obj)
			for (pronoun0 of Object.keys(cur_form_obj)){
				//corr_en=en_forms[ar_tense]
				en_vp=en_forms["base"] //should be base
				if (ar_tense=="past") en_vp=en_forms[ar_tense]
				if (ar_tense=="imperative") en_vp=en_forms["base"]	
				if (ar_tense=="base") en_vp=en_forms["base"]		
				if (ar_tense=="future") en_vp= "will "+ en_forms["base"]
				if (ar_tense=="present" && (pronoun0=="he" || pronoun0=="she")) en_vp=en_forms["-s"]
				if (ar_tense=="active"){
					if (pronoun0[0]=="I") en_vp="am "+ en_forms["-ing"]
					else if (pronoun0=="he" || pronoun0=="she") en_vp="is "+ en_forms["-ing"]
					else en_vp= en_forms["-ing"]
				} //en_vp=en_forms[ar_tense]
				en_full=pronoun0+" "+en_vp
				ar_form0=cur_form_obj[pronoun0]
				tmp_obj={}
				tmp_obj["number"]=num0
				tmp_obj["id"]=id0
				tmp_obj["tense"]=ar_tense
				tmp_obj["pronoun"]=pronoun0
				tmp_obj["en_base"]=en_forms["base"]
				tmp_obj["en_vp"]=en_full
				tmp_obj["ar_form"]=ar_form0


				//console.log(ar_tense,pronoun0,en_full,cur_form_obj[pronoun0])
				q_list.push(tmp_obj)
				conj_list.push(tmp_obj)
				tense_pronoun_key=[ar_tense,pronoun0]
				found_items_with_same_tense_pronoun=tense_pronoun_obj[tense_pronoun_key]
				if (found_items_with_same_tense_pronoun==null) found_items_with_same_tense_pronoun=[]
				found_items_with_same_tense_pronoun.push(tmp_obj)
				tense_pronoun_obj[tense_pronoun_key]=found_items_with_same_tense_pronoun

				//console.log(tmp_obj)
			}
		}
		verb_conjugations_obj[id0]=conj_list
		// console.log(en_forms)
		// console.log(ar_forms)

	}
	// console.log(verb_conjugations_obj)
	// console.log(tense_pronoun_obj)
	console.log(q_list.length)
	shuffle(q_list) //instead of random shuffling, we can assign weights to verbs based on 1- their importance (lower number) 2- the frequency of mistakes with them
	for (tmp_item0 of q_list){
		//get different verbs
		cur_q_obj={}
		cur_q_obj.verb_id=tmp_item0.id
		cur_q_obj.tense=tmp_item0.tense
		cur_q_obj.pronoun=tmp_item0.pronoun
		cur_q_obj.english=tmp_item0.en_base
		cur_q_obj.number=tmp_item0.number


		// cur_q_obj.prompt=""
		// cur_q_obj.correct=""
		// cur_q_obj.item=""
		cur_q_obj.options=[]
		//cur_q_obj.options.push(tmp_item0)
		q_types=["recognition","use","conjugation_recognition","conjugation_use","mix_recognition","mix_use"] //recognition: translate Arabic V to english / Use - opposite / conjugation_r: recognize the cojugation / conjugation_u: use the conjugation / mix is when there are different verbs with different conjugations
		cur_q_obj.type=shuffle(q_types)[0]
		// if (cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="conjugation_recognition"){
		// 	other_conjugations=

		// continue

		if (cur_q_obj.type=="recognition" || cur_q_obj.type=="conjugation_recognition" || cur_q_obj.type=="mix_recognition"){
			cur_q_obj.prompt="Which verb is this?"

			item_label=tmp_item0.ar_form[0]+" "+tmp_item0.ar_form[1]
			cur_q_obj.item=item_label
			
			cur_q_obj.correct=tmp_item0.en_vp
			cur_q_obj.audio=tmp_item0.ar_form[0]
			cur_option={}
			cur_option.label=tmp_item0.en_vp
			cur_option.name=tmp_item0.en_vp
			cur_q_obj.options.push(cur_option)
		}
		if (cur_q_obj.type=="use" || cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="mix_use"){
			cur_q_obj.prompt="How do you say this?"
			cur_q_obj.item=tmp_item0.en_vp
			cur_q_obj.correct=tmp_item0.ar_form[0]
			cur_q_obj.audio=tmp_item0.ar_form[0]
			cur_option={}
			op_label=tmp_item0.ar_form[0]+" "+tmp_item0.ar_form[1]
			cur_option.label=op_label
			cur_option.name=tmp_item0.ar_form[0]
			cur_q_obj.options.push(cur_option)	 		
		}

		if (cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="conjugation_recognition"){
			corr_conjugation_list=verb_conjugations_obj[tmp_item0.id]
			corr_conjugation_list=shuffle(corr_conjugation_list)
			for (tmp_item1 of corr_conjugation_list){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="conjugation_recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="conjugation_use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}
		//now for creating questions with the same tense/pronoun
		if (cur_q_obj.type=="recognition" || cur_q_obj.type=="use"){
			cur_key=[tmp_item0.tense,tmp_item0.pronoun]
			corr_verb_list=tense_pronoun_obj[cur_key]
			corr_verb_list=shuffle(corr_verb_list)
			for (tmp_item1 of corr_verb_list){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}

		//now for creating questions with mixed clues -options have different verbs with different conjugations and tenses/pronouns
		if (cur_q_obj.type=="mix_recognition" || cur_q_obj.type=="mix_use"){
			cur_i=getRandomInt(len(q_list)-4)-len(q_list) //negative number, showing the slice from a random index to the end 
			//cur_key=[tmp_item0.tense,tmp_item0.pronoun]
			corr_verb_slice=q_list.slice(cur_i) //tense_pronoun_obj[cur_key]
			//corr_verb_list=shuffle(corr_verb_list)
			for (tmp_item1 of corr_verb_slice){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="mix_recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="mix_use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}


		cur_q_obj.options=shuffle(cur_q_obj.options)
		//console.log(cur_q_obj)
		tmp_question_list.push(cur_q_obj)

	} //end of the iteration over the question objects
	return tmp_question_list
}

$( document ).ready(function() {
    console.log( "ready!" );
    init()

});

function init(){
	console.log("Hello")
	//$$("main_div").setAttribute("style","height:50px");
	load_settings()

	gsap.fromTo("#continue2menu", {opacity: 0}, {opacity: 1, duration: 4});
	arabic_var=nav_dict.arabic_var

	//gsap.from("continue2menu", {scaleX:0.1, scaleY:0.1}).to("continue2menu", {duration: 4, scaleX:2, scaleY:2});

	//fname="txt/verbs-eg-data.json" //this should go after selecting which Arabic
	// fname="txt/verbs-eg_ar-data.json"
	// fname="txt/verbs-msa-data.json"
	// fname="txt/verbs-"+arabic_var+"-data.json"
	// read_file(fname,function(obj1){
	// 	//console.log(obj1)
	// 	game_data=obj1
	// 	// verb_id_list verb_dict
	// 	verb_id_list=[]
	// 	for (verb0 of game_data){
	// 		console.log(verb0)
	// 		verb_id_list.push(verb0.id)
	// 		verb_dict[verb0.id]=verb0
	// 	}
	// 	loading.loaded_data=true
	// 	//prepare_questions()
	// 	go2menu()
	// })

// 	FB.getLoginStatus(function(response) {
//     statusChangeCallback(response);
// });

	// cur_qs_dict=parse_qs()
	// arabic_var=cur_qs_dict.arabic_var
	// cur_screen=cur_qs_dict.screen
	// console.log(cur_qs_dict,arabic_var)
	// //cur_qs_dict["ts"]="ab"
	// joined=join_qs(cur_qs_dict)
	// console.log(joined)
	if (cur_screen!=null) show_screen(cur_screen)
	// {
	// 	screen_selector="#"+cur_screen
	// 	$(".screen").hide()
	// 	$(screen_selector).show()	
	// 	gsap.from(screen_selector, {duration: 1, x: -1000});
	// 	//gsap.to(screen_selector, {duration: 1, x: 0});		
	// }

	
	//
}

$(document).ready(function(){
	$(".screen").hide()
	$("#intro_div").show()

})

function show_screen(screen_id){
	screen_selector="#"+screen_id
	$(".screen").hide()
	$(screen_selector).show()	
	//gsap.from(screen_selector, {duration: 1, x: -1000});  //or any other animation	
}

function go2menu(){
	$(".screen").hide()
	
	if (nav_dict.arabic_var!=null) {
		load_arabic()
		nav_dict.screen="main_menu" //show_screen("main_menu")
	} 
	else {
		nav_dict.screen="arabic_selection_menu"
		show_screen(nav_dict.screen)
	}
	nav_dict["last_active"]=Date.now()
	set_local_strorage(app_name,"nav_dict",nav_dict)
	
}
function increment(obj1){
	if (obj1==null || obj1==undefined) obj1=0
	return obj1+1	
}
function get_subobj(obj1,key1){
	if (obj1[key1] ==null || obj1[key1]==undefined) obj1[key1]={}
	return obj1[key1]	
}

function remove_listeners(el0){
	var old_element = el0;
	var new_element = old_element.cloneNode(true);
	old_element.parentNode.replaceChild(new_element, old_element);	
}


function check_answer(evt){
	cur_transition_emoji=shuffle(transition_emojis)[0]
	$$("mood_img").src=cur_transition_emoji//"img/face-with-open-mouth_1f62e.png"


	cur_question=quiz.question_list[quiz.i]
	trg=evt.currentTarget
	trg.disabled=true

	// console.log(trg)
	// trg.removeEventListener("click", check_answer);
	console.log(trg)
	for (acc_scope of ["current","overall"]){
		increment_dict(accuracy,[arabic_var, acc_scope,"all","total"])
		for (metric of ["verb_id","tense","pronoun","type"]) increment_dict(accuracy,[arabic_var,acc_scope,metric,cur_question[metric],"total"])
	}
	console.log("total >>", accuracy[arabic_var]["current"]["all"])
	set_local_strorage(app_name,"accuracy",accuracy)
	
	results.n_attempted=increment(results.n_attempted)


	if (trg.name==answer.correct) is_correct(trg)
	else is_wrong(trg)

	
	// //cur_selector="#"+obj1.id
	// //gsap.to(cur_selector, {duration: 1, x: 100});
	// gsap.to(obj1, {duration: 1, x: 100});
	//gsap.to(cur_selector, {duration: 0.5, x: 0});
}

function show_hints(){ //show how many hints are available
	$$("hint_count").innerHTML=""+game_utils.hints
	// if (accuracy.current.all.correct==null) accuracy.current.all.correct=0
	// accuracy_percent=100*(accuracy.current.all.correct/accuracy.current.all.total)
	// accuracy_percent_str=""+Math.round(accuracy_percent)+"%"
	// $$("accuracy_div").innerHTML=accuracy_percent_str	
}

function show_accuracy(){ //calculate and display updated accuracy with each answer given
	acc_total=get_dict(accuracy,[arabic_var,"current","all","total"],0) //accuracy[arabic_var]["current"]["total"]
	acc_correct=get_dict(accuracy,[arabic_var,"current","all", "correct"],0) //accuracy[arabic_var]["current"]["correct"]
	acc_ratio=0
	if (acc_total>0) acc_ratio=acc_correct/acc_total
	//if (accuracy.current.all.correct==null) accuracy.current.all.correct=0
	accuracy_percent=100*acc_ratio//(accuracy.current.all.correct/accuracy.current.all.total)
	accuracy_percent_str=""+Math.round(accuracy_percent)+"%"
	$$("accuracy_div").innerHTML=accuracy_percent_str	
}

function show_score(){
	acc_total=get_dict(accuracy,[arabic_var,"current","all", "total"],0) //accuracy[arabic_var]["current"]["total"]
	acc_correct=get_dict(accuracy,[arabic_var,"current","all", "correct"],0) //accuracy[arabic_var]["current"]["correct"]
	acc_ratio=0
	if (acc_total>0) acc_ratio=acc_correct/acc_total
	console.log("check accuracy ration >>>>",acc_ratio)

	//if (accuracy.current.all.correct==null) accuracy.current.all.correct=0
	results.accuracy=acc_ratio //accuracy.current.all.correct/accuracy.current.all.total
	results.score=Math.round(10*results.n_answered*results.accuracy) 
	score_str=""+results.score
	$$("score_div").innerHTML=score_str
}

function show_coin(){
	$$("coin_count").innerHTML=game_utils.coins
}

function next_q(){
	quiz.i+=1
	deploy_question()
}


function is_correct(trg1){ //if the answer is correct
	$(".quiz-option").attr("disabled","disabled");
	$$("quiz_audio").play() //play the audio of the quiz
	$$("quiz_answer").innerHTML=trg1.innerHTML //display the quiz answer
	//change the mood image to success emoji
	gsap.to("#mood_img", {duration: 1, x:0,onComplete:function(){
		$$("mood_img").src=shuffle(positive_emojis)[0] //"img/face-with-open-mouth_1f62e.png"
	}});

	//update accuracy metrics
	cur_question=quiz.question_list[quiz.i]
	for (acc_scope of ["current","overall"]){
		increment_dict(accuracy,[arabic_var, acc_scope,"all","correct"])
		for (metric of ["verb_id","tense","pronoun","type"]) increment_dict(accuracy,[arabic_var,acc_scope,metric,cur_question[metric],"correct"])
	}
	set_local_strorage(app_name,"accuracy",accuracy)
	console.log("correct >>", accuracy[arabic_var]["current"]["all"])


	results.n_answered=increment(results.n_answered) //update number of questions answered
	show_accuracy()
	show_score()

	//animate and update coin
	game_utils.coins=increment(game_utils.coins)
	cur_coin=img("img/coin.png",onload=null,id="")
	cur_coin.height=20
	cur_coin.width=20
	trg1.appendChild(cur_coin)
	dist_obj0=get_dist(cur_coin,$$("coin_img"))
	gsap.to(cur_coin, {duration: 1, x:dist_obj0.delta_x,y: dist_obj0.delta_y,onComplete:show_coin});

	
	// accuracy_percent=100*(accuracy.current.all.correct/accuracy.current.all.total)
	// accuracy_percent_str=""+Math.round(accuracy_percent)+"%"
	// console.log(accuracy_percent_str)
	// $$("accuracy_div").innerHTML=accuracy_percent_str


	trg1.style.backgroundColor="green" //change button background to green
	// option_buttons=document.getElementsByClassName("quiz-option")
	// for (btn0 of option_buttons) remove_listeners(btn0) //remove event listeners from all the buttons	

	trg1.classList.remove("quiz-option")
	trg1.classList.add("correct")
	

	// $(".quiz-option").on('click', function(event){ //remove event listener onclick from the incorrect options
	//     event.stopPropagation();
	//     event.stopImmediatePropagation();
	// });



	gsap.to(".quiz-option", {duration: 1, opacity: 0.05});
	gsap.to(trg1, {duration: 2, y: 0,onComplete:next_q});
}



function is_wrong(trg1){
	//trg1.disabled=true
	gsap.to("#mood_img", {duration: 1, x:0,onComplete:function(){
		$$("mood_img").src=shuffle(negative_emojis)[0] //"img/face-with-open-mouth_1f62e.png"
	}});
	cur_question=quiz.question_list[quiz.i]
	for (acc_scope of ["current","overall"]){
		increment_dict(accuracy,[arabic_var, acc_scope,"all","incorrect"])
		for (metric of ["verb_id","tense","pronoun","type"]) increment_dict(accuracy,[arabic_var,acc_scope,metric,cur_question[metric],"incorrect"])
	}
	set_local_strorage(app_name,"accuracy",accuracy)
	console.log("wrong >>", accuracy[arabic_var]["current"]["all"])


	// accuracy.current.all.incorrect=increment(accuracy.current.all.incorrect)
	// accuracy.current.verb[cur_question.verb_id].incorrect=increment(accuracy.current.verb[cur_question.verb_id].incorrect)
	// accuracy.current.tense[cur_question.tense].incorrect=increment(accuracy.current.tense[cur_question.tense].incorrect)
	// accuracy.current.pronoun[cur_question.pronoun].incorrect=increment(accuracy.current.pronoun[cur_question.pronoun].incorrect)
	show_accuracy()
	show_score()

	trg1.style.backgroundColor="red"

	TweenMax.to(trg1, 0.1, {x:"+=20", yoyo:true, repeat:3,onComplete:function(evt){
		
		cur_targets=this._targets
		console.log("Hello",cur_targets)
		// for (tmp_trg of cur_targets) remove_listeners(tmp_trg)
	}});
	//remove_listeners(trg1)

	// tl = new TimelineMax({delay:0});
	// tl.to(trg1, {duration: 0.5, x: 100});
	// tl = new TimelineMax({delay:0.5});
	// tl.to(trg1, {duration: 0.5, x: 0});

}

function get_dist(obj1,obj2){
	rect1=obj1.getBoundingClientRect()
	rect2=obj2.getBoundingClientRect()
	pt1_x=rect1.x+rect1.width*0.5
	pt1_y=rect1.y+rect1.height*0.5
	pt2_x=rect2.x+rect2.width*0.5
	pt2_y=rect2.y+rect2.height*0.5
	dist_obj={}
	dist_obj.delta_x=pt2_x-pt1_x
	dist_obj.delta_y=pt2_y-pt1_y
	return dist_obj
}
// function move_item(){
// 	gsap.to("#main_menu", {duration: 1, x: 100});
// }

function load_arabic(){
	$$("lang_loading_btn").hidden=false
	lang_icon=lang_info[arabic_var]["icon"]
	audio_prefix=lang_info[arabic_var]["audio_prefix"]
	$(".lang_icon").attr("src",lang_icon);

	fname="txt/verbs-"+arabic_var+"-data.json"
	read_file(fname,function(obj1){
		//console.log(obj1)
		game_data=obj1
		// verb_id_list verb_dict
		verb_id_list=[]
		for (verb0 of game_data){
			console.log(verb0)
			verb_id_list.push(verb0.id)
			verb_dict[verb0.id]=verb0
		}
		loading.loaded_data=true
		//prepare_questions()
		$$("lang_loading_btn").hidden=true
		show_screen("main_menu")
		//go2menu()
	})	
}

function select_arabic(obj1){
	console.log(obj1.name)
	
	nav_dict.arabic_var=obj1.name
	arabic_var=obj1.name

	load_arabic()


	set_local_strorage(app_name,"nav_dict",nav_dict)
	go2menu()
}

function go2tutorial(){
	//show_screen("tutorial_menu")
	prepare_tutorial()
	$("#myModal").modal();
}


function go2quiz(){
	gen_quiz()
	deploy_pre_game()
	show_screen("pre_game_div")

}

function start_quiz(){
	show_screen("quiz_div")

	
	//accuracy.current accuracy.overall
	results={}
	results.n_answered=0
	results.n_attempted=0
	accuracy=set_dict(accuracy,[arabic_var,"current"],{})
	//accuracy=set_dict(accuracy,[arabic_var,"overall"])
	//copy overall accuracy to compare results at the end of the quiz to the "before"
	try {
		tmp_accuracy=accuracy[arabic_var]["overall"]
		overall_accuracy=JSON.parse(JSON.stringify(tmp_accuracy))
	}
	catch {
		overall_accuracy={}
	}
	// overall_accuracy=JSON.parse(JSON.stringify(get_dict(accuracy,[arabic_var,"overall"],{})))
	// console.log(overall_accuracy)

	timer.remianing_time=int(settings.quiz_time_minutes)*60 //to be set by the settings $$("timer_div")
	if (settings.quiz_time_minutes==null || settings.quiz_time_minutes==undefined) timer.remianing_time=initial_quiz_time
	start_timer("timer_div",game_ended)
	show_hints()
	deploy_question()
}

function use_hint(){
	if (game_utils.hints==0) return
	crossed=cross_out_options() //check if answers were crossed
	if (crossed){
		game_utils.hints-=1
		show_hints()
	}
}

function cross_out_options(){
	cur_question=quiz.question_list[quiz.i]
	option_buttons=document.getElementsByClassName("quiz-option") 
	n_to_cross=option_buttons.length/2
	//console.log(n_to_cross)
	if (n_to_cross<1) return false
	n_crossed=0
	option_buttons=shuffle(option_buttons)
	for (opt_btn of option_buttons){
		console.log(opt_btn)
		if (opt_btn.name==cur_question.correct) continue
		gsap.to(opt_btn, {duration: 0.2, opacity:0.05});
		opt_btn.disabled=true
		opt_btn.classList.remove("quiz-option")
		n_crossed+=1
		if (n_crossed==n_to_cross) break
	}
	return true

}

function gen_quiz(){
	// question={}
	// question.prompt="What verb is this?"
	// question.item="yal3ab"
	// question.image=""
	// question.audio=""
	// question.correct="play"
	// question.options=[{id:"play",label:"play"},
	// {id:"eat",label:"eat"},
	// {id:"drink",label:"drink"},
	// {id:"walk",label:"walk"},
	// ]
	//an algorithm for identifying the least accurate verbs, and the ones with least exposure
	n_least_accuracy=3
	n_least_total=4 
	n_all_ids=10
	cur_ids=[]
	least_accurate_ids=[] //ids of verbs of least accuracy
	least_total_ids=[] // ids of verbs of least exposure
	new_ids=[] //ids of verbs to be newly introduced

	//get the verbs done before, from the overall accuracy object
	verb_ids_completed_obj=get_dict(accuracy,[arabic_var,"overall","verb_id"],{})
	tmp_completed_verb_list=[]
	completed_ids=Object.keys(verb_ids_completed_obj)
	for (c_id of completed_ids){
		cur_total=verb_ids_completed_obj[c_id]["total"]
		cur_correct=verb_ids_completed_obj[c_id]["correct"]
		if (cur_correct==null || cur_correct==undefined) cur_correct=0
		cur_accuracy=cur_correct/cur_total
		tmp_completed_verb_list.push([c_id,cur_accuracy,cur_total])
	}
	//console.log(tmp_completed_verb_list)
	//tmp_completed_verb_list=sort_array(tmp_completed_verb_list,1,true)
	sorted_by_least_accuracy=sort_array(tmp_completed_verb_list,1,true)
	sorted_by_least_total=sort_array(tmp_completed_verb_list,2,true)
	console.log("sorted_by_least_accuracy", sorted_by_least_accuracy)
	console.log("sorted_by_least_total", sorted_by_least_total)
	for (item of sorted_by_least_accuracy){
		if (item[1]==1) continue //exclude items with 100% accuracy
		if (len(least_accurate_ids)>=n_least_accuracy) break
		least_accurate_ids.push(item[0])
		cur_ids.push(item[0])
	}
	for (item of sorted_by_least_total){
		//if (item[1]==1) continue //exclude items with 100% accuracy
		if (cur_ids.indexOf(item[0])>-1) continue

		if (len(least_total_ids)>=n_least_total) break
		least_total_ids.push(item[0])
		cur_ids.push(item[0])
	}
	for (v_id0 of verb_id_list){
		if (completed_ids.indexOf(v_id0)>-1) continue
		if (len(cur_ids)>=n_all_ids) break
		cur_ids.push(v_id0)	
		new_ids.push(v_id0)	
	}
	console.log("least_accurate_ids",least_accurate_ids)
	console.log("least_total_ids",least_total_ids)
	console.log("new_ids",new_ids)

	// tmp_completed_verb_list=sort_array(tmp_completed_verb_list,1,false)
	// console.log(tmp_completed_verb_list)
	// tmp_completed_verb_list=sort_array(tmp_completed_verb_list,2,true)
	// console.log(tmp_completed_verb_list)
	// tmp_completed_verb_list=sort_array(tmp_completed_verb_list,2,false)
	// console.log(tmp_completed_verb_list)

	//quiz.question_list=[question] - for testing
	//cur_ids=verb_id_list.slice(0,10)
	//cur_ids=verb_id_list.slice(30,50)
	quiz.question_list=prepare_questions(cur_ids)
	quiz.i=0
	quiz.cur_ids=cur_ids	
}

function repl_with_emoji(text0){
	text0=text0.replace("(>)","➡")
	text0=text0.replace("(f)","👩")
	text0=text0.replace("(m)","👨")
	text0=text0.replace("(pl)","👩👨")	
	return text0
}

function show_conj_modal(obj1){
	verb_name=obj1.name
	console.log(verb_name)
	prepare_conjugation(verb_name)
	$("#myModal").modal();
	
}

function combine_en_ar(item){
	if (item==null) return ""
	return item[0]+"<br>"+item[1]
}

function deploy_pre_game(){
	//pre_game_verb_table
	table_array=[]
	headers=["<b>English</b>","<b>Base He</b>","Past I","Past He","Imperative","Active"]
	table_array.push(headers)
	for (v_id of quiz.cur_ids){
		v_obj=verb_dict[v_id]
		english=v_obj.english.base
		ar_base_he=combine_en_ar(v_obj.basic["base_he"]) 
		ar_past_i=combine_en_ar(v_obj.basic["past_i"])
		ar_past_he=combine_en_ar(v_obj.basic["past_he"])
		ar_imperative=combine_en_ar(v_obj.basic["imperative"])
		ar_active=combine_en_ar(v_obj.basic["active"])
		conj_link='<a href="javascript:void(0)" name="_name_" onclick="show_conj_modal(this)"><b>'+ar_base_he+"</b></a>"
		conj_link=conj_link.replace("_name_",v_id)
		cur_row=["<mark>"+english+"</mark>",conj_link,ar_past_i,ar_past_he,ar_imperative,ar_active]
		table_array.push(cur_row)
	}
	fill_table("pre_game_verb_table",table_array)
	

}

function deploy_question(){
	cur_question=quiz.question_list[quiz.i]
	answer.correct=cur_question.correct
	//quiz_prompt-quiz_item - quiz_options
	$$("quiz_prompt").innerHTML=cur_question.prompt
	cur_item=cur_question.item
	cur_item=repl_with_emoji(cur_item)
	$$("quiz_item").innerHTML=cur_item
	$$("quiz_answer").innerHTML="&nbsp;"

	//audio_src="../../audio/eg-verbs-mini/"+cur_question.audio+".mp3"
	audio_src=audio_prefix+cur_question.audio+".mp3"
	audio_el=$$("quiz_audio")
	audio_el.src=audio_src
	if (cur_question.type.includes("recognition")) audio_el.controls=true
	else audio_el.controls=false


	tags_div=$$("quiz_tags")
	tags_div.innerHTML=""
	cur_tag_el_tense=create_el_basic("span",tags_div)
	cur_tag_el_tense.className="badge badge-info"
	cur_tag_el_tense.innerHTML=cur_question.tense
	
	cur_tag_el_type=create_el_basic("span",tags_div)
	cur_tag_el_type.className="badge badge-warning"
	cur_tag_el_type.innerHTML=cur_question.type

	// '<span class="badge badge-info">Info</span>'
	options_div=$$("quiz_options")
	options_div.innerHTML=""
	for (const op of cur_question.options){
		console.log(op)
		var op_btn=create_el_basic("button",options_div)
		//op_btn.className="btn btn-block btn-primary quiz-option"
		op_btn.className="btn btn-block btn-outline-dark quiz-option"
		
		cur_label=repl_with_emoji(op.label)
		op_btn.innerHTML=cur_label
		op_btn.id=op.name
		op_btn.name=op.name
		op_btn.onclick=check_answer
	}
}

function go2profile(){
	show_screen("profile_div")
	$("#login_modal").modal();

}

function go2settings(){
	show_screen("settings_div")
}

function go2selection(){
	show_screen("arabic_selection_menu")
}



function go2progress(){
	show_screen("progress_div")
	tmp_overall_analysis_obj=accuracy[arabic_var]["overall"]
	deploy_analysis_table("Verb",tmp_overall_analysis_obj["verb_id"],"progress_verb_analysis_table",is_hyperlinked=true)
	deploy_analysis_table("Tense",tmp_overall_analysis_obj["tense"],"progress_tense_analysis_table",is_hyperlinked=false)
	deploy_analysis_table("Pronoun",tmp_overall_analysis_obj["pronoun"],"progress_pronoun_analysis_table",is_hyperlinked=false)
	deploy_analysis_table("Question",tmp_overall_analysis_obj["type"],"progress_question_analysis_table",is_hyperlinked=false)
	tmp_overall_analysis_obj_all=tmp_overall_analysis_obj.all
	cur_correct=0
	cur_total=0
	if (tmp_overall_analysis_obj_all==null || tmp_overall_analysis_obj_all==undefined) cur_accuracy_ratio=0
	else {
		cur_total=tmp_overall_analysis_obj_all.total
		cur_correct=tmp_overall_analysis_obj_all.correct
		if (cur_total==null || cur_total==undefined) cur_accuracy_ratio=0
		else {
			if (cur_correct==null || cur_correct==undefined) cur_correct=0
			cur_accuracy_ratio=cur_correct/cur_total
		}		
	}

	$$("progress_accuracy_value").innerHTML=get_percent(cur_accuracy_ratio)
	$$("progress_correct_total_value").innerHTML="(correct: "+cur_correct+"/"+cur_total+")"
	deploy_sessions_table()

	//progress_accuracy_value
	
}

function deploy_sessions_table(){
//progress_sessions_table
	table_items=[]
	headers=["date","accuracy","correct","score"]	
	table_items.push(headers)
	for (prog_item of progress_history){
		correct_str=""+prog_item.correct+"/"+prog_item.total
		row_items=[prog_item.date,get_percent(prog_item.accuracy),correct_str,str(prog_item.score)]
		table_items.push(row_items)
	}
	fill_table("progress_sessions_table",table_items)
}

function update_settings(){
	settings=get_vals("settings_form")
	set_local_strorage(app_name,"settings",settings)
	console.log(settings)
	test=get_local_strorage(app_name,"settings")
	console.log(test)
	alert("Settings updated successfully")
	go2menu()
}


function update_profile(){
	console.log("updating profile")
} 
function load_settings(){
	apply_form_vals(settings,"settings_form")

}

function login_success(){
	go2menu()
	$$("dialog").hidden=false
	$( "#dialog" ).dialog();
	$('.modal').modal('hide');

}



// function checkLoginState() {
//   FB.getLoginStatus(function(response) {
//     statusChangeCallback(response);
//   });
// }


</script>


<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '443130417462988',
      cookie     : true,
      xfbml      : true,
      version    : 'v12.0'
    });
      
    FB.AppEvents.logPageView();   
      
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

<body onload="init()">

	<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v12.0&appId=443130417462988&autoLogAppEvents=1" nonce="9YXf4wrt"></script>


<!-- <div class="jumbotron text-center">
  <h1>ALIF Verbs 4</h1>
  <p>Learn Verbs in Arabic and in Dialects!</p> 
</div> -->
  
<div class="container">
  <div class="row">
    <div class="col-sm-2">
<!--       <h3>Column 1</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p> -->
    </div>
    <div class="col-sm-8 text-center" id="main_div" >
    	<div id="intro_div" class="screen" style="background-color:lavender;height: 500px">
    		<img src="img/icons/lego.png" height="50px" />
	      <h5>ALIF Verbs</h5>
	      <p>Learn Verbs in Standard Arabic and in Dialects!</p>
	      
<!-- 	      <h5>ALIF Apps</h5>
	      <h6>Arabic Learning Is Fun</h6> -->

	      <p><img id="champolu_logo" src="img/champolu_logo.png" height="100px" /></p>
<!-- 	      <h7>ALIF Apps: Arabic Learning Is Fun</h7> -->
	      <p><button id="continue2menu" class="btn btn-primary w-75" onclick="go2menu()">Continue</button></p>
<!-- 	      <button class="buttonload">
		  <i class="fa fa-spinner fa-spin"></i>Loading
		</button> -->

    	</div>
    	<div id="arabic_selection_menu" class="screen" style="background-color:lavender;height: 500px">
	      <h5>Which Arabic to learn?</h5>
	      <button class="buttonload" id="lang_loading_btn" hidden>
		  	<i class="fa fa-spinner fa-spin"></i>Loading
			</button>

	      <p><button class="btn btn-primary w-75" name="msa" onclick="select_arabic(this)">Modern Standard Arabic
	      	<img src="img/arabic.svg" height="25px">
	      </button></p>
	      <p><button class="btn btn-primary w-75" name="eg_ar" onclick="select_arabic(this)">Egyptian Arabic
	      	<img src="img/egypt.svg" height="25px">
	      </button></p>
    	</div>

    	<!-- Main Menu -->
    	<div id="main_menu" class="screen" style="background-color:lavender;height: 500px"> 
    		<div class="row">
    			<div class="col text-left">
    				 <button class="btn btn-info m-1 w-75" id="feedback_btn">&nbsp;<img src="img/incoming-envelope_1f4e8.png" height="25px" /> <br>Contact </button>
    			</div>
    			<div class="col"><h2>ALIF Verbs</h2></div>
    			<div class="col text-right"><button class="btn btn-secondary m-1 w-75" onclick="go2profile()"> <img src="img/user.png" id="profile_btn_img" class="user_avatar" height="25px"/><br>Profile </button> </div>
    		</div>
    	<div class="row">
    		<div class="col text-left">
<!--     			<div id="help_btn">&nbsp;<img src="img/float.png" height="30px" /><br> Help</div> -->
    			<button class="btn btn-success m-1 w-75" id="help_btn">&nbsp;<img src="img/float.png" height="25px" /> <br>Help </button>

				
    		</div>
    		<div class="col">
    			<span id="lang_name" class="small" hidden>Egyptian Arabic</span>
    			<img id="lang_flag" src="img/egypt.svg" height="25px" hidden/>
    			<button class="btn btn-primary btn-sm" onclick="go2selection()"><img class="lang_icon" id="lang_flag" src="img/egypt.svg" height="25px"></button>
    		</div>
    		<div class="col"></div>
    	</div>
    		
<!-- 	      <p>Egyptian Arabic 
	      	<img src="img/egypt.svg" height="25px"> <button class="btn btn-primary btn-sm">Change</button></p> -->
	      	<div class="text-center">
	      		<p>Go to tutorial to learn the verbs, then start the quiz</p>	
			  <button type="button" class="btn btn-warning w-75 m-2" onclick="go2tutorial()">
			    Tutorials and Lessons
			  </button>	<br>    
			  <button class="btn btn-primary w-75 m-2" onclick="go2quiz()">Quiz!</button>  			
	      	</div>
	      
<!-- 	      <p><button class="btn btn-primary btn-block" onclick="go2tutorial()" hidden>Tutorial</button></p> -->
<!-- 	        <p> <button type="button" class="btn btn-block btn-warning" data-toggle="modal" data-target="#myModal"> -->




<!-- 	      <div class="container-fluid d-flex flex-column h-100">
	      </div> -->
	      <div class="row">
	      	<div class="col">
	      		<img src="img/trophy.png" height="30px"><br>
	      		0 Days Streak
	      	</div>
	      	<div class="col">
	      		<img src="img/clock.png" height="30px"><br>
	      		0/5 minutes today</div>
	      </div>
	      <!-- Very UGLY hack to keep the bottom menu at the bottom -->
<!-- 	      <div style="height: 150px;"></div> -->
	      

<!-- 	      <div id="bottom-menu-nav" class="row justify-content-center align-self-center" style="height: 40px"> -->
<!-- 	      <div id="bottom-menu-nav" style="position: absolute;height: 40px;width:100%;bottom: 40px">  -->
	      	    <div id="bottom_nav" class="flex" style="position: absolute;heigh:50px;width:100%;top: 440px">
			        <div style="width:100%" onclick="go2settings()">
						<img src="img/gear.png" height="30px"><br>
						<small>Settings</small>
			        </div>
			        <div style="width:100%" onclick="go2progress()"> 
						<img src="img/rocket.png" height="30px"><br>
						<small>Progress</small>
			        </div>
			        <div style="width:100%">
						<img src="img/star_2b50.png" height="30px"><br>
						<small>Leaderboard</small>
			        </div>
			        <div style="width:100%">
						<img src="img/shopping-cart_1f6d2.png" height="30px"><br>
						<small>Shop</small>
			        </div>
			    </div>

<!--             </div> -->

<!-- 	      <div class="row" style="top: 380px;position: absolute;"> 
                <div class="col-sm-3">Settings</div>
                <div class="col-sm-3">Progress</div>
                <div class="col-sm-3">Leaderboard</div>
                <div class="col-sm-3">Shop</div>
            </div>
 -->
    	</div>

    	<div id="tutorial_menu" class="screen">
	      <h5>Tutorials</h5>
	      <p>Videos</p>
	      <p><button class="btn btn-primary btn-block">Verb Tenses</button></p>
	      <p><button class="btn btn-primary btn-block">Verb Conjugations</button></p>
	      <p><button class="btn btn-primary btn-block">Verb Lists</button></p>

	      <p><button class="btn btn-primary btn-block" onclick="go2menu()">Main Menu</button></p>
    	</div>
   		<div id="progress_div" class="screen">
	      <h5>My Progress</h5>
<!-- 	      <p class="nav">
	      	Hello
	      </p> -->
<ul class="nav nav-tabs">
  <li class="nav-item">
    <a class="nav-link active" data-toggle="tab" href="#progress_accuracy">Accuracy</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#progress_sessions">Sessions</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="tab" href="#progress_badges">Badges</a>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane container active" id="progress_accuracy">
  	<div>Overall Accuracy: <h4 id="progress_accuracy_value">100%</h4> <h5 id="progress_correct_total_value">0/0</h5></div>
  	<p>Check your performance for different verbs, tenses, pronouns, and question types</p>
	<ul class="nav nav-tabs">
	  <li class="nav-item">
	    <a class="nav-link active" data-toggle="tab" href="#progress_accuracy_verbs">Verbs</a>
	  </li>
	  <li class="nav-item">
	    <a class="nav-link" data-toggle="tab" href="#progress_accuracy_tenses">Tenses</a>
	  </li>
	  <li class="nav-item">
	    <a class="nav-link" data-toggle="tab" href="#progress_accuracy_pronouns">Pronouns</a>
	  </li>
	  <li class="nav-item">
	    <a class="nav-link" data-toggle="tab" href="#progress_accuracy_question_types">Questions</a>
	  </li>	  
	</ul>

	<div class="tab-content">
		<div class="tab-pane container active" id="progress_accuracy_verbs">Verb Accuracy
			<table id="progress_verb_analysis_table" class="table table-striped"></table>
		</div>
		<div class="tab-pane container fade" id="progress_accuracy_tenses">Tense Accuracy
			<table id="progress_tense_analysis_table" class="table table-striped"></table>
		</div>
		<div class="tab-pane container fade" id="progress_accuracy_pronouns">Pronoun Accuracy
			<table id="progress_pronoun_analysis_table" class="table table-striped"></table>
		</div>
		<div class="tab-pane container fade" id="progress_accuracy_question_types">Question Accuracy
			<table id="progress_question_analysis_table" class="table table-striped"></table>
		</div>
	</div>





  </div>
  <div class="tab-pane container fade" id="progress_sessions">Your progress over sessions
  	<table id="progress_sessions_table" class="table table-striped"></table>
  </div>
  <div class="tab-pane container fade" id="progress_badges">No badges yet</div>
</div>

<!-- 	      <p>Sessions - Accuracy</p>
	      <p>Badges and Achievements</p>
	      <p>My Mistakes</p> -->
	      <button class="btn btn-primary w-75 m-1" onclick="go2menu()">Back to menu</button>
    	</div>
   		<div id="pre_game_div" class="screen">
	      <h5>Starting the Quiz</h5>
	      <button class="btn btn-primary w-75 m-2" onclick="start_quiz()">Start Quiz</button>
	      <p>These are the verbs we will be covering here<br>Click on each to see the full conjugation:</p>
	      <div class="table-responsive-sm">
	      	<table id="pre_game_verb_table" class="table table-striped"></table>
	      </div>
	      <button class="btn btn-primary w-75 m-2" onclick="start_quiz()" class="m-2">Start Quiz</button>

    	</div>
<!-- <i class="fa fa-bars" aria-hidden="true"></i> -->
<!-- <i class="fa fa-clock-o" aria-hidden="true"></i> -->
   		<div id="quiz_div" class="screen">
   			<div class="row">
   				<div class="col" onclick="go2menu()">Menu <img src="img/home.png" height="20px" /> </div>
   				<div class="col"><span id="timer_div">05:12</span> <img src="img/clock.png" height="20px" /> </div>
   				<div class="col"><span id="score_div">Score</span> <img src="img/trophy.png" height="20px" /></div>
   				<div class="col"><span id="accuracy_div">100%</span> <img src="img/target.png" height="20px" /></div>
   			</div> 


	      <p id="quiz_prompt">Prompt: What does this verb mean?</p> 
	      <h2 id="quiz_item">yel3ab</h2>
	      <audio id="quiz_audio" src="../../audio/eg-verbs-mini/shoof.mp3" controls></audio>
	      <h2 id="quiz_answer" style="color: green"></h2>
	      <div id="quiz_tags"></div>
	      <div id="quiz_options">
			<button class="btn btn-primary btn-block" id="quiz_option0" onclick="check_answer(this)">Walk</button>
			<button class="btn btn-primary btn-block" id="quiz_option1" onclick="check_answer(this)">Play</button>
			<button class="btn btn-primary btn-block" id="quiz_option2" onclick="check_answer(this)">Eat</button>
			<button class="btn btn-primary btn-block" id="quiz_option3" onclick="check_answer(this)">Sleep</button>
	      </div>
   			<div class="row m-1">
   				<div class="col"><span id="coin_count">0</span>&nbsp;<img id="coin_img" src="img/coin.png" height="20px" /></div>
   				<div class="col"><img id="mood_img" src="img/slightly-smiling-face_1f642.png" height="20px" /></div>
   				<div class="col" onclick="use_hint()"><span id="hint_count">0</span>&nbsp;<img src="img/light-bulb.png" height="20px" /></div>
   			</div> 

    	</div>
   		<div id="after_game_div" class="screen">
	      <h5>Game Over</h5>
	      <p><img src="img/trophy.png" height="20px" /> Your Score: <span id="after_game_score"></span>
	      	<span id="highscore_div" hidden><img src="img/military-medal_1f396-fe0f.png" height="20px" /> <b>High Score!</b></span>
	      </p> 
	      <p><img src="img/target.png" height="20px" /> Accuracy: <span id="after_game_accuracy"></span></p>
	      <p><img src="img/check.png" height="20px" /> Correct: <span id="after_game_correct_total"></span></p> 
	      <h3 id="accuracy_analysis">Accuracy Analysis</h3>
	      <table id="analysis_table" class="table table-striped"></table>
	      <div id="social_media_follow" class="text-center">
	      	<h5>Follow us:</h5>
	      	<div class="fb-like" data-href="https://facebook.com/archampolu" data-width="100" data-layout="button" data-action="like" data-size="small" data-share="true"></div>
			<script src="https://apis.google.com/js/platform.js"></script> <div class="g-ytsubscribe" data-channelid="UCFxqaKvMQKOlsZ6WsFmEJOg" data-layout="default" data-count="default"></div>	
	      </div>
	                      

	      <p><button class="btn btn-primary btn-block" onclick="go2menu()">Main Menu</button></p>
    	</div>
   		<div id="profile_div" class="screen">
	      <h5>Profile</h5>

	      
	      <div class="row">
	      	<div class="col text-right">Choose a username</div>
	      	<div class="col text-left"><input type="text" name="username" id="profile_username"/></div>
	      </div>
	      	
	      <h5>Choose avatar</h5>
	      <img id="selected_avatar" src="img/user.png" height="40px"/>
	      <p>Available Avatars</p>
	      <div id="avatar_space"></div>
	      <button class="btn btn-primary w-75 m-1" onclick="update_profile()">Update Profile</button>
	      <button class="btn btn-danger w-75 m-1" onclick="go2menu()">Discard Changes</button>	      

    	</div>   

   		<div id="settings_div" class="screen">
	      <h5>Settings</h5>
		<div class="form-group">
			  <label for="quiz_time_minutes">Quiz time (minutes)</label>
			  <select class="form-control settings_form" name="quiz_time_minutes" id="quiz_time_minutes">
			    <option value="1">1</option>
			    <option value="2">2</option>
			    <option value="3">3</option>
			    <option value="4">4</option>
			    <option value="5" selected>5</option>
			  </select>
			</div>	      

		<div class="form-group">
			  <label for="daily_goal_minutes">Daily goal (minutes)</label>
			  <select class="form-control settings_form" name="daily_goal_minutes" id="daily_goal_minutes">
			    <option value="5">5</option>
			    <option value="10" selected>10</option>
			    <option value="15">15</option>
			    <option value="20">20</option>
			    <option value="25">25</option>
			    <option value="30">30</option>
			  </select>
			</div>	

		<div class="form-group">
			  <label for="quiz_script">Script:</label>
			  <select class="form-control settings_form" name="quiz_script" id="quiz_script" disabled>
			    <option value="ar_rom" selected>Arabic Script + Romanization (kalimah كلمة)</option>
			    <option value="rom_only">Romanization Only (kalimah)</option>
			    <option value="ar_only">Arabic Script Only (كلمة)</option>
			  </select>
			</div>


	        <label class="form-check-label">
		    <input type="checkbox" class="form-check-input settings_form" name="play_audio" checked disabled>Play audio after quiz
		  </label><br>

<!-- 	      <p>Play music effects</p> --> 

	



	      <button class="btn btn-primary w-75 m-1" onclick="update_settings()">Update Settings</button>
	      <button class="btn btn-danger w-75 m-1" onclick="go2menu()">Discard Changes</button>

    	</div>  

   		<div id="login_signup_div" class="screen">
	      <h5>Login/Signup</h5>
	      <p>Continue With Google</p>
	      <p>Continue With Facebook</p>
	      <p>Continue With email</p>
    	</div>     
   		<div id="about_div" class="screen">
	      <h5>About this game</h5>
	      <p>Acknowledgments</p>
    	</div>  
   		<div id="leaderboard_div" class="screen">
	      <h5>Leaderboard </h5>
	      <p>High Scores</p>
    	</div>  
   		<div id="feedback_div" class="screen">
	      <h5>Feedback</h5>
	      <p>Your feedback</p>
    	</div> 

  <!-- The Modal -->
  <div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Tutorial</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
          <h5>Let's learn about these verbs</h5>
          <div id="tutorial_content"></div>
          <audio id="tutorial_audio" src="../../audio/eg-verbs-mini/shoof.mp3"></audio>
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div> 
  <!-- Modal End -->

  <!-- Login/Signup Modal -->
  <div class="modal" id="login_modal">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">

          <h4 class="modal-title">Login/Signup</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
        	

			 <!-- <div id="my-signin2"></div> -->
			 <div class="g-signin2 m-1" data-onsuccess="onSignIn" data-theme="dark" data-width="300" data-height="40"></div>
			 <div class="row">
			 	<div class="col"></div>
			 	<div class="col">
			 <fb:login-button scope="public_profile,email" onlogin="checkLoginState();" autologoutlink="true" size="large"> Continue with Facebook
			</fb:login-button>

<!-- 			 		<div class="fb-login-button m-1" data-width="300" data-size="large" data-button-type="continue_with" data-layout="default" data-auto-logout-link="false" data-use-continue-as="false"></div>
 -->			 		
			 	</div>
			 	<div class="col"></div>

			 </div>

<!-- 			<div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-layout="default" data-auto-logout-link="true" data-use-continue-as="false"></div> -->


			 <hr>
			OR email login

	      <div class="row m-1">
	      	<div class="col text-left"></div>
	      	<div class="col text-left">
	      		<input type="text" name="email" id="login_email" class="m-1" placeholder="Email" /><br>
	      		
	      	</div>
	      	<div class="col"></div>
	      </div>
	      <button class="btn btn-primary w-75 m-1" onclick="login_success()"> Submit Email</button>
<!-- 	      <button class="btn btn-primary btn-block"> Continue as Guest</button> -->
	      	




        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger btn-block" data-dismiss="modal">OR Continue as Guest</button>
        </div>
        
      </div>
    </div>
  </div> 
  <!-- Modal End -->



    </div>
    <div class="col-sm-2" id="ad_space">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1461464026864680"
     crossorigin="anonymous"></script>
      <!-- alif-verbs-vertical -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-1461464026864680"
           data-ad-slot="5100857947"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

<!--       <h3>Column 3</h3>        
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p> -->
    </div>
  </div>



</div>

<div id="dialog" title="Message" hidden>
  <p id="dialogue_message">Login Successful</p>
</div>


    <script>
    	//Google amd Facebook functions - login/logout
      function onSignIn(googleUser) {
        // Useful data for your client-side scripts:
        console.log(googleUser)
        var profile = googleUser.getBasicProfile();
        console.log(profile)
        console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        console.log('Full Name: ' + profile.getName());
        console.log('Given Name: ' + profile.getGivenName());
        console.log('Family Name: ' + profile.getFamilyName());
        console.log("Image URL: " + profile.getImageUrl());
        console.log("Email: " + profile.getEmail());

        // The ID token you need to pass to your backend:
        var id_token = googleUser.getAuthResponse().id_token;
        console.log("ID Token: " + id_token);
      }
    </script>
<!--       <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script> -->
      <script type="text/javascript">
      	    function onSuccess(googleUser) {
      console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
    }
    function onFailure(error) {
      console.log(error);
    }

      	function renderButton() {
      gapi.signin2.render('my-signin2', {
        'scope': 'profile email',
        'width': 240,
        'height': 40,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
    }

	function checkLoginState() {
	    FB.getLoginStatus(function(response) {
	      statusChangeCallback(response);
	    });
	  }

	function statusChangeCallback(response) {
    // body...
    if(response.status === 'connected'){
      // setElements(true);
      let userId = response.authResponse.userID;
      // console.log(userId);
      console.log('login');
      getUserInfo(userId);

    }
    else{
      // setElements(false);
      console.log('not logged in !');
    }
  }

  function getUserInfo(userId) {
    // body...
    FB.api(
      '/'+userId+'/?fields=id,name,email',
      'GET',
      {},
      function(response) {
        // Insert your code here
        console.log(response);
        let email = response.email;
        //loginViaEmail(email);
      }
    );
  }
  function fb_logout(){
	  FB.api('/me/permissions', 'delete', function(response) {
	    console.log(response.status); // true for successful logout.
	});  	
  }


	function google_logout() {
	    gapi.auth2.getAuthInstance().signOut().then(function () {
	      console.log('User signed out.');
	      location.reload();
	    });

	}
      </script>

<!-- For PWA implementation -->
<!-- </div> -->
  <script src="js/pwa_main.js"></script>



</body>
</html>
