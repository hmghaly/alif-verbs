<!DOCTYPE html>
<html lang="en">
<head>
  <title>ALIF Verbs</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
  <link rel="stylesheet" href="css/font-awesome-4.7.0/css/font-awesome.min.css">

  <script src="js/script.js"></script>

<!--   <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1461464026864680"
     crossorigin="anonymous"></script> -->

</head>

<script type="text/javascript">
var arabic_var=null //"msa" //ega lva sya lba maa saa gla iqa kwa lya sda dza tna 
var cur_screen=null
var user={}
var quiz={}
var answer={}
var session={}
var timer={}
var game_data={}
var results={}

var audio_prefix="../../audio/eg-verbs-mini/"

var app_name="alif-verbs"
// nav_dict["arabic_var"]=null
// nav_dict["screen"]=null
// nav_dict["last_active"]=Date.now();
time_now=Date.now()
//set_local_strorage(app_name,"nav_dict",nav_dict)
var nav_dict=get_local_strorage(app_name,"nav_dict")
if (nav_dict==null || nav_dict==undefined) var nav_dict={}

var score=get_local_strorage(app_name,"score")
if (score==null || score==undefined) var score={}	
if (score.coins==null || score.coins==undefined) score.coins=0

var accuracy=get_local_strorage(app_name,"accuracy")
if (accuracy==null || accuracy==undefined) accuracy={}
if (accuracy.overall==null) accuracy.overall={}
if (accuracy.current==null) accuracy.current={}
	
// if (accuracy.overall==null || accuracy.overall==undefined) var accuracy.overall={}
// if (accuracy.current==null || accuracy.current==undefined) var accuracy.current={} //accuracy.current accuracy.overall


// if (nav_dict.last_active==null) nav_dict.last_active=time_now;
// time_diff_from_last_active=time_now-nav_dict.last_active
// console.log("time diff",time_diff_from_last_active)

// if (nav_dict.last_active==null) nav_dict.screen=null
// else if (time_now-nav_dict.last_active>120000) nav_dict.screen=null //for a idle time > 120 seconds, reset the navigation screen
//nav_dict["last_active"]=Date.now();
//set_local_strorage(app_name,"nav_dict",nav_dict)

var cur_address=window.location.pathname //"/dev/alif-verbs/"


// function seconds2str(seconds){
//     n_seconds=seconds%60
//     n_minutes=(seconds-n_seconds)/60
//     n_minutes_str=""+n_minutes
//     n_seconds_str=""+n_seconds
//     if (n_seconds_str.length==1) n_seconds_str="0"+n_seconds_str
//     timer_str=n_minutes_str+":"+n_seconds_str	
// 	return timer_str
// }

// function start_timer(timer_id,callback_fn,interval=1000){ //
// 	timer_str=seconds2str(timer.remianing_time)
// 	$$(timer_id).innerHTML=timer_str
// 	timer.starter = setInterval(function(){
// 		console.log(timer.remianing_time)
// 		timer.remianing_time-=interval/1000
// 		console.log(timer.remianing_time)
// 		timer_str=seconds2str(timer.remianing_time)
// 		$$(timer_id).innerHTML=timer_str
// 		if (timer.remianing_time<=0) {
// 			callback_fn()
// 			clearInterval(timer.starter)
// 		} 
// 	}, interval);

// 	//console.log(timer_str)
// }

// function pause_timer(){
// 	clearInterval(timer.starter)
// }

function game_ended(){
	show_screen("after_game_div")
	//after_game_score after_game_accuracy after_game_correct_total analysis_table
	$$("after_game_score").innerHTML=""+results.score
	$$("after_game_accuracy").innerHTML=""+Math.round(results.accuracy*100)+"%"
	correct_total_str=""+results.n_answered+ " / "+results.n_attempted
	$$("after_game_correct_total").innerHTML=correct_total_str
	keys=["correct","incorrect","total"]
	headers=["Verb",'correct <img src="img/check.png" height="20px" />','incorrect <img src="img/wrong.png" height="20px" />',"total"]

	table_array=[]
	table_array.push(headers)
	for (verb_item of Object.keys(accuracy.current.verb)){
		cur_row_items=[verb_item]
		for (k0 of keys){
			cur_val=accuracy.current.verb[verb_item][k0]
			if (cur_val==null) cur_val=0
			cur_row_items.push(""+cur_val)
		}
		table_array.push(cur_row_items)

	}
	fill_table("analysis_table",table_array)
	//accuracy.current.verb

}


function prepare_tutorial(){
	tutorial_content=$$("tutorial_content")
	for (const v_obj of game_data.slice(0,10)){
		conj_list=[]
		console.log(v_obj)
		en_forms=v_obj["english"]
		en_base=en_forms.base
		cur_verb_div=create_el_basic("div",tutorial_content)
		cur_verb_div.className="m-1"
		en_header=create_el_basic("h6",cur_verb_div)
		en_header.innerHTML=en_base+"<hr>"
		en_header.style.backgroundColor="lightpink"
		en_header.className="pt-3"
		
		//var forms_table=create_el_basic("table",tutorial_content)
		table_array=[]


		ar_forms=v_obj["forms"]
		//ar_tenses=Object.keys(ar_forms)
		//ar_pronouns=Object.keys(ar_forms.present)
		for (ar_tense of Object.keys(ar_forms)){
			cur_form_obj=ar_forms[ar_tense]
			cur_tense_div=create_el_basic("div",cur_verb_div)
			tense_header=create_el_basic("h7",cur_tense_div)
			tense_header.innerHTML="Tense: "+ ar_tense
			tense_header.style.backgroundColor="lightgreen"
			cur_conj_div=create_el_basic("div",cur_tense_div)
			cur_conj_div.className="row"

			colors=["Azure","Beige","AliceBlue","HoneyDew","Ivory","LavenderBlush","MistyRose","SeaShell"]
			colors_i=0
			for (pronoun0 of Object.keys(cur_form_obj)){
				//corr_en=en_forms[ar_tense]
				en_vp=en_forms["base"] //should be base
				if (ar_tense=="past") en_vp=en_forms[ar_tense]
				if (ar_tense=="imperative") en_vp=en_forms["base"]	
				if (ar_tense=="base") en_vp=en_forms["base"]		
				if (ar_tense=="future") en_vp= "will "+ en_forms["base"]
				if (ar_tense=="present" && (pronoun0=="he" || pronoun0=="she")) en_vp=en_forms["-s"]
				if (ar_tense=="active") en_vp= en_forms["-ing"]
				en_full=pronoun0+" "+en_vp
				ar_form0=cur_form_obj[pronoun0]
				console.log(en_full,ar_form0)
				cur_temp_div=create_el_basic("div",cur_conj_div)
				cur_temp_div.innerHTML="<b>"+en_full+"</b><br>"+ar_form0[0]+"<br>"+ar_form0[1]+"<br>"
				cur_temp_div.className="col-sm-4"
				cur_temp_div.style.backgroundColor=colors[colors_i]
				colors_i+=1
				play_img=img("img/play.png")
				play_img.width=20
				play_img.name=audio_prefix+ar_form0[0]+".mp3"
				play_img.onclick=function(evt){
					//console.log(evt.currentTarget)
					audioObj = new Audio(evt.currentTarget.name);
					audioObj.addEventListener("canplaythrough", event => {
					  /* the audio is now playable; play it if permissions allow */
					  audioObj.play();
					})

				}

				cur_temp_div.appendChild(play_img)

			}
		}
		// headers=ar_tenses
		// headers.unshift("");
		// table_array.push(headers)
		// for (pronoun0 of ar_pronouns){
		// 	cur_row_items=[pronoun0]
		// 	for  (tense0 of ar_tenses){
		// 		try {cur_val=ar_forms[tense0][pronoun0]}
		// 		catch {cur_val=null}
		// 		if (cur_val==null) cell_val=""
		// 		else cell_val=cur_val[0]+" "+cur_val[1]
		// 		cur_row_items.push(cell_val)
		// 	}
		// 	table_array.push(cur_row_items)
		// }
		// //fill_table(forms_table,table_array)
		// var forms_table=create_table(tutorial_content,table_array)
		// forms_table.className="table table-bordered"

		//console.log(ar_tenses,ar_pronouns)
	}
}

function prepare_questions(){
	tmp_question_list=[]
	q_list=[]
	verb_conjugations_obj={} //combining all conjugation questions with the same verb ID
	tense_pronoun_obj={} //object to combine questions with the same tense and pronouns from different verbs
	//data_obj=shuffle(game_data)
	//console.log(game_data)
	for (const v_obj of game_data.slice(0,10)){
		conj_list=[]
		console.log(v_obj)
		en_forms=v_obj["english"]
		ar_forms=v_obj["forms"]
		num0=v_obj["number"]
		id0=v_obj["id"]
		console.log(en_forms)
		for (ar_tense of Object.keys(ar_forms)){
			cur_form_obj=ar_forms[ar_tense]
			//console.log(ar_tense,cur_form_obj)
			for (pronoun0 of Object.keys(cur_form_obj)){
				//corr_en=en_forms[ar_tense]
				en_vp=en_forms["base"] //should be base
				if (ar_tense=="past") en_vp=en_forms[ar_tense]
				if (ar_tense=="imperative") en_vp=en_forms["base"]	
				if (ar_tense=="base") en_vp=en_forms["base"]		
				if (ar_tense=="future") en_vp= "will "+ en_forms["base"]
				if (ar_tense=="present" && (pronoun0=="he" || pronoun0=="she")) en_vp=en_forms["-s"]
				if (ar_tense=="active"){
					if (pronoun0[0]=="I") en_vp="am "+ en_forms["-ing"]
					else if (pronoun0=="he" || pronoun0=="she") en_vp="is "+ en_forms["-ing"]
					else en_vp= en_forms["-ing"]
				} //en_vp=en_forms[ar_tense]
				en_full=pronoun0+" "+en_vp
				ar_form0=cur_form_obj[pronoun0]
				tmp_obj={}
				tmp_obj["number"]=num0
				tmp_obj["id"]=id0
				tmp_obj["tense"]=ar_tense
				tmp_obj["pronoun"]=pronoun0
				tmp_obj["en_base"]=en_forms["base"]
				tmp_obj["en_vp"]=en_full
				tmp_obj["ar_form"]=ar_form0


				//console.log(ar_tense,pronoun0,en_full,cur_form_obj[pronoun0])
				q_list.push(tmp_obj)
				conj_list.push(tmp_obj)
				tense_pronoun_key=[ar_tense,pronoun0]
				found_items_with_same_tense_pronoun=tense_pronoun_obj[tense_pronoun_key]
				if (found_items_with_same_tense_pronoun==null) found_items_with_same_tense_pronoun=[]
				found_items_with_same_tense_pronoun.push(tmp_obj)
				tense_pronoun_obj[tense_pronoun_key]=found_items_with_same_tense_pronoun

				//console.log(tmp_obj)
			}
		}
		verb_conjugations_obj[id0]=conj_list
		// console.log(en_forms)
		// console.log(ar_forms)

	}
	// console.log(verb_conjugations_obj)
	// console.log(tense_pronoun_obj)
	console.log(q_list.length)
	shuffle(q_list) //instead of random shuffling, we can assign weights to verbs based on 1- their importance (lower number) 2- the frequency of mistakes with them
	for (tmp_item0 of q_list){
		//get different verbs
		cur_q_obj={}
		cur_q_obj.verb_id=tmp_item0.id
		cur_q_obj.tense=tmp_item0.tense
		cur_q_obj.pronoun=tmp_item0.pronoun
		cur_q_obj.english=tmp_item0.en_base
		cur_q_obj.number=tmp_item0.number


		// cur_q_obj.prompt=""
		// cur_q_obj.correct=""
		// cur_q_obj.item=""
		cur_q_obj.options=[]
		//cur_q_obj.options.push(tmp_item0)
		q_types=["recognition","use","conjugation_recognition","conjugation_use","mix_recognition","mix_use"] //recognition: translate Arabic V to english / Use - opposite / conjugation_r: recognize the cojugation / conjugation_u: use the conjugation / mix is when there are different verbs with different conjugations
		cur_q_obj.type=shuffle(q_types)[0]
		// if (cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="conjugation_recognition"){
		// 	other_conjugations=

		// continue

		if (cur_q_obj.type=="recognition" || cur_q_obj.type=="conjugation_recognition" || cur_q_obj.type=="mix_recognition"){
			cur_q_obj.prompt="Which verb is this?"
			item_label=tmp_item0.ar_form[0]+" "+tmp_item0.ar_form[1]
			cur_q_obj.item=item_label
			
			cur_q_obj.correct=tmp_item0.en_vp
			cur_q_obj.audio=tmp_item0.ar_form[0]
			cur_option={}
			cur_option.label=tmp_item0.en_vp
			cur_option.name=tmp_item0.en_vp
			cur_q_obj.options.push(cur_option)
		}
		if (cur_q_obj.type=="use" || cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="mix_use"){
			cur_q_obj.prompt="How do you say this?"
			cur_q_obj.item=tmp_item0.en_vp
			cur_q_obj.correct=tmp_item0.ar_form[0]
			cur_q_obj.audio=tmp_item0.ar_form[0]
			cur_option={}
			op_label=tmp_item0.ar_form[0]+" "+tmp_item0.ar_form[1]
			cur_option.label=op_label
			cur_option.name=tmp_item0.ar_form[0]
			cur_q_obj.options.push(cur_option)	 		
		}

		if (cur_q_obj.type=="conjugation_use" || cur_q_obj.type=="conjugation_recognition"){
			corr_conjugation_list=verb_conjugations_obj[tmp_item0.id]
			corr_conjugation_list=shuffle(corr_conjugation_list)
			for (tmp_item1 of corr_conjugation_list){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="conjugation_recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="conjugation_use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}
		//now for creating questions with the same tense/pronoun
		if (cur_q_obj.type=="recognition" || cur_q_obj.type=="use"){
			cur_key=[tmp_item0.tense,tmp_item0.pronoun]
			corr_verb_list=tense_pronoun_obj[cur_key]
			corr_verb_list=shuffle(corr_verb_list)
			for (tmp_item1 of corr_verb_list){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}

		//now for creating questions with mixed clues -options have different verbs with different conjugations and tenses/pronouns
		if (cur_q_obj.type=="mix_recognition" || cur_q_obj.type=="mix_use"){
			cur_i=getRandomInt(len(q_list)-4)-len(q_list) //negative number, showing the slice from a random index to the end 
			//cur_key=[tmp_item0.tense,tmp_item0.pronoun]
			corr_verb_slice=q_list.slice(cur_i) //tense_pronoun_obj[cur_key]
			//corr_verb_list=shuffle(corr_verb_list)
			for (tmp_item1 of corr_verb_slice){
				if (tmp_item0==tmp_item1) continue
				cur_option={}
				if (cur_q_obj.type=="mix_recognition") {
					cur_option.label=tmp_item1.en_vp
					cur_option.name=tmp_item1.en_vp					
				}
				if (cur_q_obj.type=="mix_use") {
					cur_option.label=tmp_item1.ar_form[0]+" "+tmp_item1.ar_form[1]
					cur_option.name=tmp_item1.ar_form[0]			
				}

				if (cur_option.name==cur_q_obj.correct) continue
				cur_q_obj.options.push(cur_option)
				if 	(cur_q_obj.options.length==4) break	
			}
			//console.log(corr_conjugation_list)
		}


		cur_q_obj.options=shuffle(cur_q_obj.options)
		//console.log(cur_q_obj)
		tmp_question_list.push(cur_q_obj)

	} //end of the iteration over the question objects
	return tmp_question_list
}
function init(){
	console.log("Hello")
	fname="txt/verbs-eg-data.json"
	read_file(fname,function(obj1){
		//console.log(obj1)
		game_data=obj1
		//prepare_questions()
		go2menu()
	})

	// cur_qs_dict=parse_qs()
	// arabic_var=cur_qs_dict.arabic_var
	// cur_screen=cur_qs_dict.screen
	// console.log(cur_qs_dict,arabic_var)
	// //cur_qs_dict["ts"]="ab"
	// joined=join_qs(cur_qs_dict)
	// console.log(joined)
	if (cur_screen!=null) show_screen(cur_screen)
	// {
	// 	screen_selector="#"+cur_screen
	// 	$(".screen").hide()
	// 	$(screen_selector).show()	
	// 	gsap.from(screen_selector, {duration: 1, x: -1000});
	// 	//gsap.to(screen_selector, {duration: 1, x: 0});		
	// }

	
	//
}

$(document).ready(function(){
	$(".screen").hide()
	$("#intro_div").show()

})

function show_screen(screen_id){
	screen_selector="#"+screen_id
	$(".screen").hide()
	$(screen_selector).show()	
	//gsap.from(screen_selector, {duration: 1, x: -1000});  //or any other animation	
}

function go2menu(){
	$(".screen").hide()
	nav_dict.screen="arabic_selection_menu"
	if (nav_dict.arabic_var!=null) nav_dict.screen="main_menu"
	nav_dict["last_active"]=Date.now()
	set_local_strorage(app_name,"nav_dict",nav_dict)
	show_screen(nav_dict.screen)
}
function increment(obj1){
	if (obj1==null || obj1==undefined) obj1=0
	return obj1+1	
}
function get_subobj(obj1,key1){
	if (obj1[key1] ==null || obj1[key1]==undefined) obj1[key1]={}
	return obj1[key1]	
}

// function recursive_obj(initial_obj,subkeys,level=0){
// 	if (level>=len(subkeys)) return initial_obj
// 	cur_subkey=subkeys[level]
// 	if (initial_obj[cur_subkey]==null || initial_obj[cur_subkey]==undefined) initial_obj[cur_subkey]={}
// 	initial_obj[cur_subkey]=recursive_obj(initial_obj,subkeys,level+1)
// 	return initial_obj
// }

function check_answer(evt){
	cur_question=quiz.question_list[quiz.i]
	trg=evt.currentTarget
	console.log(trg)
	accuracy.current.all=get_subobj(accuracy.current,"all")
	accuracy.current.verb=get_subobj(accuracy.current,"verb")
	accuracy.current.tense=get_subobj(accuracy.current,"tense")
	accuracy.current.pronoun=get_subobj(accuracy.current,"pronoun")
	accuracy.current.verb[cur_question.verb_id]=get_subobj(accuracy.current.verb,cur_question.verb_id)
	accuracy.current.tense[cur_question.tense]=get_subobj(accuracy.current.tense,cur_question.tense)
	accuracy.current.pronoun[cur_question.pronoun]=get_subobj(accuracy.current.pronoun,cur_question.pronoun)
	//console.log("check1", accuracy.current.all.total)
	accuracy.current.all.total=increment(accuracy.current.all.total)
	//console.log("check2", accuracy.current.all.total)
	accuracy.current.verb[cur_question.verb_id].total=increment(accuracy.current.verb[cur_question.verb_id].total)
	accuracy.current.tense[cur_question.tense].total=increment(accuracy.current.tense[cur_question.tense].total)
	accuracy.current.pronoun[cur_question.pronoun].total=increment(accuracy.current.pronoun[cur_question.pronoun].total)

	results.n_attempted=increment(results.n_attempted)
	// accuracy.current.tense.total=increment(accuracy.current.tense.total)
	// accuracy.current.pronoun.total=increment(accuracy.current.pronoun.total)

	// for (key0 of ["all","verb","tense","pronoun"]){
	// 	if (accuracy.current[key0]==null || accuracy.current[key0]==undefined) accuracy.current[key0]={}
	// 	if (accuracy.current[key0][cur_question.pronoun]==null || accuracy.current[key0][cur_question.pronoun]==undefined) accuracy.current[key0][cur_question.pronoun]={}
	// 	if (accuracy.current[key0][cur_question.verb_id]==null || accuracy.current[key0][cur_question.pronoun]==undefined) accuracy.current[key0][cur_question.pronoun]={}	
	// 	accuracy.current[key0][cur_question.pronoun].total=increment(accuracy.current[key0][cur_question.pronoun].total)

	// }
	// if (accuracy.current.total==null || accuracy.current.total==undefined) accuracy.current.total=0
	// accuracy.current.total+=1

	if (trg.name==answer.correct) is_correct(trg)
	else is_wrong(trg)

	
	// //cur_selector="#"+obj1.id
	// //gsap.to(cur_selector, {duration: 1, x: 100});
	// gsap.to(obj1, {duration: 1, x: 100});
	//gsap.to(cur_selector, {duration: 0.5, x: 0});
}

function show_accuracy(){ //calculate and display updated accuracy with each answer given
	if (accuracy.current.all.correct==null) accuracy.current.all.correct=0
	accuracy_percent=100*(accuracy.current.all.correct/accuracy.current.all.total)
	accuracy_percent_str=""+Math.round(accuracy_percent)+"%"
	$$("accuracy_div").innerHTML=accuracy_percent_str	
}

function show_score(){
	if (accuracy.current.all.correct==null) accuracy.current.all.correct=0
	results.accuracy=accuracy.current.all.correct/accuracy.current.all.total
	results.score=Math.round(10*results.n_answered*results.accuracy) 
	score_str=""+results.score
	$$("score_div").innerHTML=score_str
}

function show_coin(){
	$$("coin_count").innerHTML=score.coins
}

function next_q(){
	quiz.i+=1
	deploy_question()
}


function is_correct(trg1){
	$$("quiz_audio").play()

	cur_question=quiz.question_list[quiz.i]
	accuracy.current.all.correct=increment(accuracy.current.all.correct)
	console.log("accuracy.current.all.correct",accuracy.current.all.correct)
	accuracy.current.verb[cur_question.verb_id].correct=increment(accuracy.current.verb[cur_question.verb_id].correct)
	accuracy.current.tense[cur_question.tense].correct=increment(accuracy.current.tense[cur_question.tense].correct)
	accuracy.current.pronoun[cur_question.pronoun].correct=increment(accuracy.current.pronoun[cur_question.pronoun].correct)
	results.n_answered=increment(results.n_answered)
	show_accuracy()
	show_score()
	// rect=trg1.getBoundingClientRect()
	// console.log(rect)
	score.coins=increment(score.coins)
	cur_coin=img("img/coin.png",onload=null,id="")
	cur_coin.height=20
	cur_coin.width=20
	trg1.appendChild(cur_coin)
	dist_obj0=get_dist(cur_coin,$$("coin_img"))
	//img_str='<img src="img/coin.png" id="cur_coin" width="25px" />'
	// img_str='<img id="cur_coin" src="img/coin.png" height="20px" />'
	// trg1.innerHTML+=" "+img_str
	// cur_coin=$$("cur_coin")

	gsap.to(cur_coin, {duration: 1, x:dist_obj0.delta_x,y: dist_obj0.delta_y,onComplete:show_coin});
	
	
	// accuracy_percent=100*(accuracy.current.all.correct/accuracy.current.all.total)
	// accuracy_percent_str=""+Math.round(accuracy_percent)+"%"
	// console.log(accuracy_percent_str)
	// $$("accuracy_div").innerHTML=accuracy_percent_str


	trg1.style.backgroundColor="green"
	trg1.classList.remove("quiz-option")
	trg1.classList.add("correct")
	$(".quiz-option").on('click', function(event){ //remove event listener onclick from the incorrect options
	    event.stopPropagation();
	    event.stopImmediatePropagation();
	});

	gsap.to(".quiz-option", {duration: 1, opacity: 0.05});
	gsap.to(trg1, {duration: 2, y: 0,onComplete:next_q});
}

function is_wrong(trg1){
	cur_question=quiz.question_list[quiz.i]
	accuracy.current.all.incorrect=increment(accuracy.current.all.incorrect)
	accuracy.current.verb[cur_question.verb_id].incorrect=increment(accuracy.current.verb[cur_question.verb_id].incorrect)
	accuracy.current.tense[cur_question.tense].incorrect=increment(accuracy.current.tense[cur_question.tense].incorrect)
	accuracy.current.pronoun[cur_question.pronoun].incorrect=increment(accuracy.current.pronoun[cur_question.pronoun].incorrect)
	show_accuracy()
	show_score()

	trg1.style.backgroundColor="red"
	TweenMax.to(trg1, 0.1, {x:"+=20", yoyo:true, repeat:3});

	// tl = new TimelineMax({delay:0});
	// tl.to(trg1, {duration: 0.5, x: 100});
	// tl = new TimelineMax({delay:0.5});
	// tl.to(trg1, {duration: 0.5, x: 0});

}

function get_dist(obj1,obj2){
	rect1=obj1.getBoundingClientRect()
	rect2=obj2.getBoundingClientRect()
	pt1_x=rect1.x+rect1.width*0.5
	pt1_y=rect1.y+rect1.height*0.5
	pt2_x=rect2.x+rect2.width*0.5
	pt2_y=rect2.y+rect2.height*0.5
	dist_obj={}
	dist_obj.delta_x=pt2_x-pt1_x
	dist_obj.delta_y=pt2_y-pt1_y
	return dist_obj
}
// function move_item(){
// 	gsap.to("#main_menu", {duration: 1, x: 100});
// }

function select_arabic(obj1){
	console.log(obj1.name)
	nav_dict.arabic_var=obj1.name
	set_local_strorage(app_name,"nav_dict",nav_dict)
	go2menu()
}

function go2tutorial(){
	//show_screen("tutorial_menu")
	prepare_tutorial()
	$("#myModal").modal();
}

function start_quiz(){
	show_screen("quiz_div")
	gen_quiz()
	//accuracy.current accuracy.overall
	results={}
	results.n_answered=0
	results.n_attempted=0
	accuracy.current={}
	timer.remianing_time=300 //to be set by the settings
	start_timer("timer_div",game_ended)
	deploy_question()
}

function gen_quiz(){
	// question={}
	// question.prompt="What verb is this?"
	// question.item="yal3ab"
	// question.image=""
	// question.audio=""
	// question.correct="play"
	// question.options=[{id:"play",label:"play"},
	// {id:"eat",label:"eat"},
	// {id:"drink",label:"drink"},
	// {id:"walk",label:"walk"},
	// ]

	//quiz.question_list=[question] - for testing
	quiz.question_list=prepare_questions()
	quiz.i=0	
}

function repl_with_emoji(text0){
	text0=text0.replace("(>)","➡")
	text0=text0.replace("(f)","👩")
	text0=text0.replace("(m)","👨")
	text0=text0.replace("(pl)","👩👨")	
	return text0
}

function deploy_question(){
	cur_question=quiz.question_list[quiz.i]
	answer.correct=cur_question.correct
	//quiz_prompt-quiz_item - quiz_options
	$$("quiz_prompt").innerHTML=cur_question.prompt
	cur_item=cur_question.item
	cur_item=repl_with_emoji(cur_item)
	$$("quiz_item").innerHTML=cur_item

	audio_src="../../audio/eg-verbs-mini/"+cur_question.audio+".mp3"
	audio_el=$$("quiz_audio")
	audio_el.src=audio_src
	if (cur_question.type.includes("recognition")) audio_el.controls=true
	else audio_el.controls=false


	tags_div=$$("quiz_tags")
	tags_div.innerHTML=""
	cur_tag_el=create_el_basic("span",tags_div)
	cur_tag_el.className="badge badge-info"
	cur_tag_el.innerHTML=cur_question.tense
	// '<span class="badge badge-info">Info</span>'
	options_div=$$("quiz_options")
	options_div.innerHTML=""
	for (const op of cur_question.options){
		console.log(op)
		var op_btn=create_el_basic("button",options_div)
		//op_btn.className="btn btn-block btn-primary quiz-option"
		op_btn.className="btn btn-block btn-outline-dark quiz-option"
		
		cur_label=repl_with_emoji(op.label)
		op_btn.innerHTML=cur_label
		op_btn.id=op.name
		op_btn.name=op.name
		op_btn.onclick=check_answer
	}
}
</script>

<body onload="init()">

<!-- <div class="jumbotron text-center">
  <h1>ALIF Verbs 4</h1>
  <p>Learn Verbs in Arabic and in Dialects!</p> 
</div> -->
  
<div class="container">
  <div class="row">
    <div class="col-sm-3">
<!--       <h3>Column 1</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p> -->
    </div>
    <div class="col-sm-6 text-center" id="main_div" style="background-color:lavender;">
    	<div id="intro_div" class="screen">
	      <h5>ALIF Verbs</h5>
	      <p>Learn Verbs in Arabic and in Dialects!</p>
	      <p><button class="btn btn-primary btn-block" onclick="go2menu()">Continue</button></p>

	      <p><img id="champolu_logo" src="img/champolu_logo.png" height="100px" /></p>

    	</div>
    	<div id="arabic_selection_menu" class="screen">
	      <h5>Which Arabic to learn?</h5>
	      <p><button class="btn btn-primary btn-block" name="msa" onclick="select_arabic(this)" hidden>Modern Standard Arabic</button></p>
	      <p><button class="btn btn-primary btn-block" name="ega" onclick="select_arabic(this)">Egyptian Arabic</button></p>
    	</div>

    	<div id="main_menu" class="screen"> 
	      <h5>Get Started!</h5>
	      <p>Go to tutorial to learn the verbs, then start the quiz</p>
	      <p><button class="btn btn-primary btn-block" onclick="go2tutorial()" hidden>Tutorial</button></p>
<!-- 	        <p> <button type="button" class="btn btn-block btn-warning" data-toggle="modal" data-target="#myModal"> -->
			  <p>  <button type="button" class="btn btn-block btn-warning" onclick="go2tutorial()">
			    Tutorial
			  </button></p>

	      <p><button class="btn btn-primary btn-block" onclick="start_quiz()">Start Quiz!</button></p>
	      <p hidden>Help Button - Feedback Button</p>
    	</div>

    	<div id="tutorial_menu" class="screen">
	      <h5>Tutorials</h5>
	      <p>Videos</p>
	      <p><button class="btn btn-primary btn-block">Verb Tenses</button></p>
	      <p><button class="btn btn-primary btn-block">Verb Conjugations</button></p>
	      <p><button class="btn btn-primary btn-block">Verb Lists</button></p>

	      <p><button class="btn btn-primary btn-block" onclick="go2menu()">Main Menu</button></p>
    	</div>
   		<div id="progress_div" class="screen">
	      <h5>My Progress</h5>
	      <p>Sessions - Accuracy</p>
	      <p>Badges and Achievements</p>
	      <p>My Mistakes</p>
    	</div>
   		<div id="quiz_div" class="screen">
   			<div class="row">
   				<div class="col" onclick="go2menu()">Menu <i class="fa fa-bars" aria-hidden="true"></i></div>
   				<div class="col"><span id="timer_div">05:12</span> <i class="fa fa-clock-o" aria-hidden="true"></i></div>
   				<div class="col"><span id="score_div">Score</span> <img src="img/trophy.png" height="20px" /></div>
   				<div class="col"><span id="accuracy_div">100%</span> <img src="img/target.png" height="20px" /></div>
   			</div> 


	      <p id="quiz_prompt">Prompt: What does this verb mean?</p> 
	      <h2 id="quiz_item">yel3ab</h2>
	      <audio id="quiz_audio" src="../../audio/eg-verbs-mini/shoof.mp3" controls></audio>
	      <div id="quiz_tags"></div>
	      <p id="quiz_answer"></p>
	      <div id="quiz_options">
			<button class="btn btn-primary btn-block" id="quiz_option0" onclick="check_answer(this)">Walk</button>
			<button class="btn btn-primary btn-block" id="quiz_option1" onclick="check_answer(this)">Play</button>
			<button class="btn btn-primary btn-block" id="quiz_option2" onclick="check_answer(this)">Eat</button>
			<button class="btn btn-primary btn-block" id="quiz_option3" onclick="check_answer(this)">Sleep</button>
	      </div>
   			<div class="row m-1">
   				<div class="col"><span id="coin_count">0</span>&nbsp;<img id="coin_img" src="img/coin.png" height="20px" /></div>
   				<div class="col"><img id="mood_img" src="img/slightly-smiling-face_1f642.png" height="20px" /></div>
   				<div class="col"><span id="hint_count">0</span>&nbsp;<img src="img/light-bulb.png" height="20px" /></div>
   			</div> 

    	</div>
   		<div id="after_game_div" class="screen">
	      <h5>Game Over</h5>
	      <p><img src="img/trophy.png" height="20px" /> Your Score: <span id="after_game_score"></span>
	      	<span id="highscore_div" hidden><img src="img/military-medal_1f396-fe0f.png" height="20px" /> <b>High Score!</b></span>
	      </p> 
	      <p><img src="img/target.png" height="20px" /> Accuracy: <span id="after_game_accuracy"></span></p>
	      <p><img src="img/check.png" height="20px" /> Correct: <span id="after_game_correct_total"></span></p> 
	      <h3 id="accuracy_analysis">Accuracy Analysis</h3>
	      <table id="analysis_table" class="table table-striped"></table>
	      <p><button class="btn btn-primary btn-block" onclick="go2menu()">Main Menu</button></p>
    	</div>
   		<div id="profile_div" class="screen">
	      <h5>Profile</h5>
	      <p>Choose a username</p>
	      <p>Choose avatar</p>
    	</div>   

   		<div id="settings_div" class="screen">
	      <h5>Settings</h5>
	      <p>Audio settings</p>
	      <p>Layout settings</p>
    	</div>  

   		<div id="login_signup_div" class="screen">
	      <h5>Login/Signup</h5>
	      <p>Continue With Google</p>
	      <p>Continue With Facebook</p>
	      <p>Continue With email</p>
    	</div>     
   		<div id="about_div" class="screen">
	      <h5>About this game</h5>
	      <p>Acknowledgments</p>
    	</div>  
   		<div id="leaderboard_div" class="screen">
	      <h5>Leaderboard </h5>
	      <p>High Scores</p>
    	</div>  
   		<div id="feedback_div" class="screen">
	      <h5>Feedback</h5>
	      <p>Your feedback</p>
    	</div> 

  <!-- The Modal -->
  <div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Tutorial</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
          <h5>Let's learn about these verbs</h5>
          <div id="tutorial_content"></div>
          <audio id="tutorial_audio" src="../../audio/eg-verbs-mini/shoof.mp3"></audio>
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div> 
  <!-- Modal End -->


    </div>
    <div class="col-sm-3" id="ad_space">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1461464026864680"
     crossorigin="anonymous"></script>
      <!-- alif-verbs-vertical -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-1461464026864680"
           data-ad-slot="5100857947"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>

<!--       <h3>Column 3</h3>        
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit...</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris...</p> -->
    </div>
  </div>
</div>


</body>
</html>
